ğŸŒ¿ AutojunÃ§Ã£o e Consultas HierÃ¡rquicas no Oracle SQL

ğŸ” 1. AutojunÃ§Ã£o
A autojunÃ§Ã£o Ã© quando uma tabela Ã© unida com ela mesma â€” Ãºtil, por exemplo, para mostrar relaÃ§Ãµes entre funcionÃ¡rios e gerentes.

ğŸ§ª Exemplo:

SELECT e.nome AS Empregado,
       m.nome AS Gerente
FROM funcionarios e
JOIN funcionarios m
ON e.id_gerente = m.id_func;

ğŸ“Œ Aqui, a tabela funcionarios Ã© usada duas vezes:

e representa os empregados

m representa os gerentes

ğŸŒ³ 2. Consulta HierÃ¡rquica
Usada quando queremos representar estruturas de nÃ­veis (ex: organogramas, categorias de produtos, pastas, etc).

âœ… Sintaxe:

SELECT nome, id_func, id_gerente
FROM funcionarios
START WITH id_gerente IS NULL
CONNECT BY PRIOR id_func = id_gerente;

ğŸ”¹ START WITH: define a raiz da hierarquia
ğŸ”¹ CONNECT BY: define a relaÃ§Ã£o entre os nÃ­veis
ğŸ”¹ PRIOR: define qual lado da relaÃ§Ã£o representa o nÃ­vel anterior

ğŸ“‹ 3. RelatÃ³rio Estruturado em Ãrvore
VocÃª pode formatar a saÃ­da com indentaÃ§Ã£o pra parecer uma Ã¡rvore!

ğŸ’¡ Exemplo com indentaÃ§Ã£o:

SELECT LPAD(' ', LEVEL * 2) || nome AS Estrutura
FROM funcionarios
START WITH id_gerente IS NULL
CONNECT BY PRIOR id_func = id_gerente;
ğŸ”¸ LEVEL representa o nÃ­vel hierÃ¡rquico
ğŸ”¸ LPAD ajuda a formatar com espaÃ§os conforme o nÃ­vel

âœ‚ï¸ 4. Excluir RamificaÃ§Ãµes da Ãrvore
Use a clÃ¡usula WHERE com CONNECT_BY_ISLEAF, LEVEL, ou filtros especÃ­ficos:

ğŸ›‘ Excluir galhos a partir de certo gerente:

SELECT nome
FROM funcionarios
START WITH id_gerente IS NULL
CONNECT BY PRIOR id_func = id_gerente
AND id_func != 3; -- exclui a ramificaÃ§Ã£o do gerente com id 3


âœ… Mostrar sÃ³ "folhas" (sem subordinados):

SELECT nome
FROM funcionarios
START WITH id_gerente IS NULL
CONNECT BY PRIOR id_func = id_gerente
HAVING CONNECT_BY_ISLEAF = 1;


âœ… Dica bÃ´nus: ver a profundidade da Ã¡rvore

SELECT nome, LEVEL AS nivel_hierarquico
FROM funcionarios
START WITH id_gerente IS NULL
CONNECT BY PRIOR id_func = id_gerente;
